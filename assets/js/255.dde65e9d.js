(window.webpackJsonp=window.webpackJsonp||[]).push([[255],{820:function(t,e,r){"use strict";r.r(e);var a=r(14),o=Object(a.a)({},(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"http-proxy"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#http-proxy"}},[t._v("#")]),t._v(" Http Proxy")]),t._v(" "),r("p",[t._v("本地代理其实有两种方式：")]),t._v(" "),r("h4",{attrs:{id:"方式-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#方式-1"}},[t._v("#")]),t._v(" 方式 1")]),t._v(" "),r("p",[t._v("1、第一种本地代理方式，比如 devServer 使用 "),r("a",{attrs:{href:"https://github.com/chimurai/http-proxy-middleware#readme",target:"_blank",rel:"noopener noreferrer"}},[t._v("http-proxy-middleware"),r("OutboundLink")],1),t._v("，本地起代理服务器 httpProxy，浏览器发出 ajax 请求时，比如请求 example.com/abc，实际是请求到 localhost:3000。再由 httpProxy 做代理转发到 example.com/abc 获取数据，从而绕过浏览器跨域限制。")]),t._v(" "),r("p",[t._v("这里特别说明下 "),r("code",[t._v("changeOrigin")]),t._v(" 配置项，它的作用"),r("strong",[t._v("并不是为了解决跨域问题，而是去改变请求 header 中的 host 值为 target 地址")]),t._v("。其主要解决的问题是"),r("code",[t._v("虚拟主机技术中单 IP 多域名")]),t._v("的情况（💡 Tip: Set the option changeOrigin to true for "),r("a",{attrs:{href:"https://en.wikipedia.org/wiki/Virtual_hosting#Name-based",target:"_blank",rel:"noopener noreferrer"}},[t._v("name-based virtual hosted sites"),r("OutboundLink")],1),t._v(".）")]),t._v(" "),r("ul",[r("li",[t._v("默认情况下，当 localhost 将请求转发到 example.com 时，因为 changeOrigin 为 false，所以会带请求头为 host: localhost:3000。此时如果目标服务器是多虚拟机的情况，则因为没有指定正确的 host 而导致找不到服务，而返回 404；")]),t._v(" "),r("li",[t._v("如果设置 changeOrigin: true，当 localhost 将请求转发到 example.com 时，会带请求头为 host: example.com，即指向 target。此时就能正常访问对应服务。")]),t._v(" "),r("li",[t._v("当然，如果目标服务器不存在多虚拟机的情况，并且后端应用逻辑无需校验指定请求的 URL，也可以忽略不设置 changeOrigin。")])]),t._v(" "),r("div",{staticClass:"custom-block tip"},[r("p",{staticClass:"custom-block-title"},[t._v("虚拟主机技术")]),t._v(" "),r("p",[t._v("简而言之，就是主要应用在虚拟主机技术上。虚拟主机（virtual hosting）即共享主机（shared web hosting），可以利用虚拟技术把一台完整的服务器分成若干个主机，因此可以在单一主机上运行多个网站或服务。")]),t._v(" "),r("p",[t._v("比如说有一台 ip 地址为 11.11.11.11 的服务器，在这台服务器上部署着淘宝、京东、拼多多的网站，并且配置了三个虚拟主机：a.com, b.com, c.com, 这三个域名都指向 11.11.11.11。 当我们访问 c.com 的网站时，看到的是拼多多的页面而不是淘宝和京东的页面，原因就是 Host 请求头决定着访问哪个虚拟主机。")])]),t._v(" "),r("div",{staticClass:"custom-block tip"},[r("p",{staticClass:"custom-block-title"},[t._v("跨域的判断原理")]),t._v(" "),r("p",[t._v("首先要明确，跨域的判断是由浏览器完成的，不是服务端。")]),t._v(" "),r("ul",[r("li",[t._v("浏览器先根据同源策略对前端 origin 和请求的 target 做匹配，若同源，则直接发送数据请求；若不同源，则发送跨域请求。")]),t._v(" "),r("li",[t._v("服务器解析程序收到浏览器跨域请求时，若未配置过任何允许跨域的配置，则响应 header 中不包含 Access-Control-Allow-origin 字段，若有跨域配置，则返回 Access-Control-Allow-origin+ 对应配置规则里的域名的方式。")]),t._v(" "),r("li",[t._v("浏览器是明确知道自己请求 header 的 origin 的，首先发送预检请求判断跨域，当收到 http 响应时，发现响应 header 中没有 Access-Control-Allow-origin 字段，说明不允许跨域，则报跨域错误；若有 Access-Control-Allow-origin 字段，则对字段内容和当前域名（即请求 header 的 origin）做比对，如果同源，则说明可以跨域，浏览器发送真实请求；若不同源，则说明该域名不可跨域，不发送真实请求。")])])]),t._v(" "),r("h4",{attrs:{id:"方式-2"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#方式-2"}},[t._v("#")]),t._v(" 方式 2")]),t._v(" "),r("p",[t._v("2、第二种本地代理方式是类似 charles 起代理，当浏览器访问一个地址比如 example.com 时，将其劫持，并做一些访问控制。")]),t._v(" "),r("h2",{attrs:{id:"参考链接"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[t._v("#")]),t._v(" 参考链接")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://segmentfault.com/a/1190000003710973",target:"_blank",rel:"noopener noreferrer"}},[t._v("浏览器和服务器实现跨域（CORS）判定的原理"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://marskid.net/2018/01/13/webpack-devserver-proxy/",target:"_blank",rel:"noopener noreferrer"}},[t._v("webpack 代理返回 404，changeOrigin 的原理"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://www.cnblogs.com/houxianzhou/p/14743623.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Webpack Proxy 工作原理？为什么能解决跨域?"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://juejin.cn/post/6844903954455724045#heading-7",target:"_blank",rel:"noopener noreferrer"}},[t._v("HTTP headers 之 host, referer, origin"),r("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=o.exports}}]);