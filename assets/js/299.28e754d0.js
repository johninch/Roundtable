(window.webpackJsonp=window.webpackJsonp||[]).push([[299],{890:function(t,s,a){"use strict";a.r(s);var n=a(14),r=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"react中的代码复用-render-props、hoc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#react中的代码复用-render-props、hoc"}},[t._v("#")]),t._v(" React中的代码复用（Render-Props、HOC）")]),t._v(" "),a("blockquote",[a("p",[t._v("组件通常是针对一类对象来说的，有很多类具有相似的行为，但是他们确实属于不同的类别。如果用面向对象的思维考虑，应该设计公用类或者接口，使用继承类或继承接口来复用功能。")])]),t._v(" "),a("blockquote",[a("p",[t._v("继承类的坏处在于大量的继承会导致类之间的关系很复杂，继承接口的坏处在于子类需要实现接口的方法，调用也比较麻烦。")])]),t._v(" "),a("blockquote",[a("p",[a("strong",[t._v("“组合优于继承”")]),t._v("，可以考虑使用组合来解决问题。")])]),t._v(" "),a("p",[t._v("React中有3种代码复用的方法：Mixin、"),a("code",[t._v("HOC")]),t._v("、"),a("code",[t._v("Render props")]),t._v("。")]),t._v(" "),a("p",[t._v("React Mixin将通用共享的方法包装成Mixins方法，然后注入各个组件实现，但Mixin已经不被官方推荐使用，所以本文只重点介绍"),a("strong",[t._v("高阶组件")]),t._v("和"),a("strong",[t._v("渲染属性")]),t._v("。")]),t._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[t._v("Mixin为何被官方废弃")]),t._v(" "),a("ol",[a("li",[t._v("Mixin引入了隐式依赖关系。")]),t._v(" "),a("li",[t._v("Mixin导致名称冲突。")]),t._v(" "),a("li",[t._v("Mixin导致复杂的滚雪球：随着时间和业务的增长， 你对Mixin的修改越来越多， 到最后会变成一个难以维护的Mixin。")]),t._v(" "),a("li",[t._v("拥抱ES6，ES6的class不支持Mixin。")])])]),t._v(" "),a("h2",{attrs:{id:"高阶组件-hoc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#高阶组件-hoc"}},[t._v("#")]),t._v(" 高阶组件 (HOC)")]),t._v(" "),a("ul",[a("li",[t._v("高阶组件是"),a("strong",[t._v("重用组件逻辑")]),t._v("的高级方法，其实只是一个装饰器模式，用于增强原有组件的功能。")]),t._v(" "),a("li",[t._v("高阶组件其实并不是组件，它只是一个函数接收一个组件作为参数，经过增加一系列新功能后，返回一个新的组件。这样返回的组件增强了功能，但渲染与原有保持一致，没有破坏原有组件的逻辑。")])]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("withUser")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("WrappedComponent")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" user "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" sessionStorage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getItem")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"user"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("props")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("WrappedComponent")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("user")]),a("span",{pre:!0,attrs:{class:"token script language-javascript"}},[a("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token spread"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[t._v("props")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("UserPage")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("props")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("div")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("class")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation attr-equals"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')]),t._v("user-container"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v('"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n    ")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("My name is ")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("props"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("p")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n  ")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("div")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("withUser")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UserPage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"渲染属性-render-props"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#渲染属性-render-props"}},[t._v("#")]),t._v(" 渲染属性 (Render props)")]),t._v(" "),a("p",[t._v("渲染属性（Render Props）也是一种在不重复代码的情况下共享组件间功能的方法。Render-Props 最重要的是"),a("code",[t._v("使用一个值为函数的prop来传递需要动态渲染的nodes或组件")]),t._v("，属性名不一定是非叫render，其它命名依然有效。")]),t._v(" "),a("div",{staticClass:"language-tsx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-tsx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 子组件依赖于父组件的某些数据时，需要将父组件的数据传到子组件，子组件拿到数据并渲染")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DataProvider")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("render")]),a("span",{pre:!0,attrs:{class:"token script language-javascript"}},[a("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cat")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("target")]),a("span",{pre:!0,attrs:{class:"token script language-javascript"}},[a("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Render Props，不是说非用一个叫render的props不可")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 习惯上可能常写成下面这种")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DataProvider")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n  ")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("data")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Cat")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[t._v("target")]),a("span",{pre:!0,attrs:{class:"token script language-javascript"}},[a("span",{pre:!0,attrs:{class:"token script-punctuation punctuation"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("/>")])]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token plain-text"}},[t._v("\n")]),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("DataProvider")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])])]),a("p",[t._v("类（对于一类事物的抽象），接口（对于一类行为的抽象）。JS 里面没有接口，所以用高阶组件和 render props 都可以达到对同一类行为的抽象。所有的手段最终都是为了提高代码的可维护性，减少使用成本。")]),t._v(" "),a("h2",{attrs:{id:"render-props-vs-hoc"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#render-props-vs-hoc"}},[t._v("#")]),t._v(" Render props VS HOC")]),t._v(" "),a("p",[t._v("总的来说，render props其实和高阶组件类似，可相互替代，就是在"),a("code",[t._v("pure component")]),t._v("上增加state，响应react的生命周期。")]),t._v(" "),a("h3",{attrs:{id:"对于hoc模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对于hoc模式"}},[t._v("#")]),t._v(" 对于HOC模式")]),t._v(" "),a("ul",[a("li",[t._v("优点如下：\n"),a("ul",[a("li",[t._v("支持ES6；")]),t._v(" "),a("li",[t._v("复用性强，HOC为纯函数且返回值为组件，可以多层嵌套；")]),t._v(" "),a("li",[a("code",[t._v("支持传入多个参数")]),t._v("，增强了适用范围；")])])]),t._v(" "),a("li",[t._v("缺点如下：\n"),a("ul",[a("li",[t._v("当多个HOC一起使用时，"),a("code",[t._v("无法直接判断")]),t._v("子组件的props是哪个HOC负责传递的；")]),t._v(" "),a("li",[t._v("多个组件嵌套，容易产生同样名称的props；")]),t._v(" "),a("li",[t._v("HOC可能会产生许多无用的组件，加深了组件的层级；")]),t._v(" "),a("li",[a("code",[t._v("静态构建")]),t._v("，需要提前构建好要使用的高阶组件。")])])])]),t._v(" "),a("h3",{attrs:{id:"render-props模式的出现主要是为了解决hoc的问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#render-props模式的出现主要是为了解决hoc的问题"}},[t._v("#")]),t._v(" Render Props模式的出现主要是为了解决HOC的问题")]),t._v(" "),a("p",[t._v("优点如下所示：")]),t._v(" "),a("ul",[a("li",[t._v("支持ES6；")]),t._v(" "),a("li",[t._v("不用担心props命名问题，在render函数中只取需要的state；")]),t._v(" "),a("li",[t._v("不会产生无用的组件加深层级；")]),t._v(" "),a("li",[t._v("render props是"),a("code",[t._v("动态构建")]),t._v("的，所有的改变都在render中触发，可以更好的利用组件内的生命周期。")])]),t._v(" "),a("h4",{attrs:{id:"参考链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[t._v("#")]),t._v(" 参考链接")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.zhihu.com/question/269915942/answer/351688035",target:"_blank",rel:"noopener noreferrer"}},[t._v("风满楼:React高阶组件和render props的适用场景有区别吗，还是更多的是个人偏好?"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://segmentfault.com/a/1190000018612397",target:"_blank",rel:"noopener noreferrer"}},[t._v("React-代码复用(mixin.hoc.render props)"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.jianshu.com/p/ff6b3008820a",target:"_blank",rel:"noopener noreferrer"}},[t._v("React组件Render Props VS HOC 设计模式"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=r.exports}}]);