(window.webpackJsonp=window.webpackJsonp||[]).push([[80],{574:function(t,a,s){t.exports=s.p+"assets/img/react-VDOM.2c501982.png"},893:function(t,a,s){"use strict";s.r(a);var e=s(14),n=Object(e.a)({},(function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[e("h1",{attrs:{id:"react虚拟dom相关"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#react虚拟dom相关"}},[t._v("#")]),t._v(" React虚拟DOM相关")]),t._v(" "),e("h2",{attrs:{id:"虚拟dom是什么"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#虚拟dom是什么"}},[t._v("#")]),t._v(" 虚拟Dom是什么")]),t._v(" "),e("p",[e("img",{attrs:{src:s(574),alt:""}})]),t._v(" "),e("ul",[e("li",[t._v("在原生的 JS中，我们直接对 DOM进行创建和更改，而 DOM元素通过我们监听的事件和我们的应用程序进行通讯。")]),t._v(" "),e("li",[t._v("而 React会先将代码转换成一个 JS对象（即虚拟DOM），然后这个 JS对象再转换成真实 DOM。")]),t._v(" "),e("li",[t._v("虚拟DOM只不过是真实 DOM 的 JS对象表示。当我们需要创建或更新元素时，React首先会让这个 Vitrual Dom对象进行创建和更改，然后再将 Vitrual Dom对象渲染成真实DOM。当我们需要对 DOM进行事件监听时，首先对 Vitrual Dom进行事件监听，Vitrual Dom 会代理原生的 DOM事件从而做出响应。")])]),t._v(" "),e("h2",{attrs:{id:"虚拟dom原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#虚拟dom原理"}},[t._v("#")]),t._v(" 虚拟Dom原理")]),t._v(" "),e("ul",[e("li",[t._v("用 JavaScript 对象模拟真实 DOM 树，对真实 DOM 进行抽象；")]),t._v(" "),e("li",[t._v("diff 算法 — 比较两棵虚拟 DOM 树的差异；")]),t._v(" "),e("li",[t._v("patch 算法 — 将两个虚拟 DOM 对象的差异应用到真正的 DOM 树。")])]),t._v(" "),e("h2",{attrs:{id:"简述react-diffing算法思路"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#简述react-diffing算法思路"}},[t._v("#")]),t._v(" 简述react diffing算法思路")]),t._v(" "),e("p",[t._v("传统的diff算法，是通过循环递归对节点进行依次对比，算法复杂度达到 "),e("code",[t._v("O(n^3)")]),t._v("，n是树的节点数，效率极低！而 React diff算法是一种"),e("code",[t._v("调和")]),t._v("实现，即将Virtual DOM树转换成最少操作的actual DOM树。")]),t._v(" "),e("p",[t._v("React 通过 "),e("strong",[t._v("三大策略")]),t._v(" 进行优化，将"),e("code",[t._v("O(n^3)复杂度 转化为 O(n)复杂度")]),t._v(":")]),t._v(" "),e("ol",[e("li",[t._v("策略一（"),e("strong",[t._v("tree diff")]),t._v("）：两棵树 只对同层次节点 进行比较。Web UI中DOM节点跨层级的移动操作特别少，可以忽略不计（如果是跨层级的话，只有创建节点和删除节点的操作，不考虑其他）。")]),t._v(" "),e("li",[t._v("策略二（"),e("strong",[t._v("component diff")]),t._v("）：\n"),e("ul",[e("li",[t._v("拥有相同类的两个组件 生成相似的树形结构，")]),t._v(" "),e("li",[t._v("拥有不同类的两个组件 生成不同的树形结构。")])])]),t._v(" "),e("li",[t._v("策略三（"),e("strong",[t._v("element diff")]),t._v("）：对于同一层级的一组子节点，通过"),e("code",[t._v("唯一key")]),t._v("区分。")])]),t._v(" "),e("h2",{attrs:{id:"虚拟dom比普通dom性能更好吗-虚拟dom优劣势"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#虚拟dom比普通dom性能更好吗-虚拟dom优劣势"}},[t._v("#")]),t._v(" 虚拟Dom比普通Dom性能更好吗？(虚拟DOM优劣势)")]),t._v(" "),e("p",[e("strong",[t._v("Vitrual Dom 可以提升性能，这一说法实际上是很片面的。")])]),t._v(" "),e("ul",[e("li",[t._v("首先，直接操作 DOM是非常耗费性能的，这一点毋庸置疑。但是 React/vue使用了 Vitrual Dom，VDOM也还是要操作 DOM，这是无法避免的。")]),t._v(" "),e("li",[t._v("并且，如果是首次渲染的话，Vitrual Dom 甚至要进行更多的计算，消耗更多的内存。")]),t._v(" "),e("li",[t._v("Vitrual Dom 的「优势」在于：\n"),e("ol",[e("li",[e("strong",[t._v("无需手动操作Dom")]),t._v("，提升开发效率：React/vue的 "),e("code",[t._v("Diff算法")]),t._v("和"),e("code",[t._v("批处理策略Patch")]),t._v(" 会在一次更新中自动完成，不用开发者手动完成（"),e("em",[t._v('实际上，这个计算过程我们在直接操作 DOM时，也是可以自己判断和实现的，但是一定会耗费非常多的精力和时间，所以，在这个过程中 React/vue帮助我们 "提升了性能"')]),t._v("）。")]),t._v(" "),e("li",[e("strong",[t._v("保证性能下限")]),t._v("：第一点提到开发者实际是可以自己手动优化完成dom更新的，但这点依赖于开发者的水平，大部分情况下自己做的是不如 React/vue好的，所以VDOM保证了性能下限。")]),t._v(" "),e("li",[e("strong",[t._v("跨平台")]),t._v(": DOM与平台强相关，而虚拟DOM本质上是JavaScript对象，相比之下虚拟DOM可以进行更方便地跨平台操作，例如服务器渲染、移动端开发等等。")])])]),t._v(" "),e("li",[t._v("Vitrual Dom 的「缺点」只有一个：\n"),e("ol",[e("li",[e("strong",[t._v("无法进行极致优化")]),t._v(": 在一些性能要求极高的应用中虚拟DOM无法进行针对性的极致优化，比如VScode采用直接手动操作DOM的方式进行极端的性能优化。")])])])]),t._v(" "),e("p",[t._v("所以，"),e("strong",[t._v("Vitrual Dom 帮助我们提高了开发效率")]),t._v("，在"),e("strong",[t._v("重复渲染时它帮助我们计算如何更高效的更新")]),t._v("，"),e("code",[t._v("而不是它比 DOM操作更快")]),t._v("。")]),t._v(" "),e("h2",{attrs:{id:"虚拟dom中的-typeof属性的作用是什么"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#虚拟dom中的-typeof属性的作用是什么"}},[t._v("#")]),t._v(" 虚拟Dom中的$$typeof属性的作用是什么？")]),t._v(" "),e("p",[t._v("ReactElement中有一个 "),e("code",[t._v("$$typeof")]),t._v("属性，它被赋值为 REACT_ELEMENT_TYPE：")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("REACT_ELEMENT_TYPE")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" Symbol "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'function'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" Symbol"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("for "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" Symbol"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("for")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'react.element'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("||")]),t._v("  "),e("span",{pre:!0,attrs:{class:"token number"}},[t._v("0xeac7")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),e("p",[e("code",[t._v("$$typeof")]),t._v("是一个 Symbol类型的变量，这个变量可以防止 XSS。如果你的服务器有一个漏洞，允许用户存储任意 JSON对象，而客户端代码需要一个字符串，这可能会成为一个问题：")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" expectedTextButGotJSON "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    type"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'div'")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    props"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        dangerouslySetInnerHTML"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            __html"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/* put your exploit here */'")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" message "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" text"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" expectedTextButGotJSON "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("p"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("message"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("text"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("p"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),e("p",[t._v("JSON中不能存储 Symbol类型的变量。")]),t._v(" "),e("p",[t._v("ReactElement.isValidElement函数用来判断一个 React组件是否是有效的，下面是它的具体实现：")]),t._v(" "),e("div",{staticClass:"language-js extra-class"},[e("pre",{pre:!0,attrs:{class:"language-js"}},[e("code",[t._v("ReactElement"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("isValidElement")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("object")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" object "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token string"}},[t._v("'object'")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n      object "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n      object"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$$"),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("typeof")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constant"}},[t._v("REACT_ELEMENT_TYPE")]),t._v("\n  "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),e("p",[t._v("React渲染时会把没有 "),e("code",[t._v("$$typeof")]),t._v("标识，以及规则校验不通过的组件过滤掉。当你的环境不支持 Symbol时，$$typeof被赋值为 0xeac7，至于为什么，React开发者给出了答案：0xeac7看起来有点像 React。")])])}),[],!1,null,null,null);a.default=n.exports}}]);