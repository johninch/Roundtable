(window.webpackJsonp=window.webpackJsonp||[]).push([[278],{855:function(t,s,a){"use strict";a.r(s);var e=a(14),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"压测工具简单实践"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#压测工具简单实践"}},[t._v("#")]),t._v(" 压测工具简单实践")]),t._v(" "),a("p",[t._v("本文通过使用 apache ab、wrk、autocannon 3 种便捷压测工具，来对接口性能做简单分析，以期了解压测评估标准与方法。")]),t._v(" "),a("p",[t._v("上述 3 种工具仅支持单机压测，其本身的定位，并不是用来取代 JMeter, LoadRunner 等专业的测试工具，而是便于开发者应付日常接口性能验证。")]),t._v(" "),a("h2",{attrs:{id:"目标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目标"}},[t._v("#")]),t._v(" 目标")]),t._v(" "),a("p",[t._v("假如，我们当前对于同一个 rpc 接口（OrderDetails）有两种调用方式：")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("方式 A")]),t._v(" 是后端直接将 rpc 接口转成 Http 接口供前端调用；")]),t._v(" "),a("li",[a("strong",[t._v("方式 B")]),t._v(" 是通过 nodejs 搭建 http-server（BFF），调用 rpc 接口后完成聚合编排供前端调用。")])]),t._v(" "),a("p",[t._v("我们分别使用 apache ab 与 wrk 两种压测工具来对两种方式的 http 接口进行性能比较。")]),t._v(" "),a("p",[t._v("接下来我们首先来了解下，一些常见的性能衡量指标。")]),t._v(" "),a("h2",{attrs:{id:"性能衡量指标"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#性能衡量指标"}},[t._v("#")]),t._v(" 性能衡量指标")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("吞吐率（RPS, Requests per second）")]),t._v("：也可以叫 "),a("code",[t._v("QPS（Query Per Second）")]),t._v("，每秒请求数，近义词有 TPS(Transaction Per Second）每秒事务数。\n"),a("ul",[a("li",[t._v("绝大多数情况下 QPS 等价于 TPS。")]),t._v(" "),a("li",[t._v("吞吐率是服务器并发处理能力的量化描述，单位是 reqs/s，指的是在某个并发用户数下单位时间内处理的请求数。某个并发用户数下单位时间内能处理的最大请求数，称之为最大吞吐率。")]),t._v(" "),a("li",[t._v("吞吐率是基于并发用户数的，不同的并发用户数下，吞吐率一般不同。")]),t._v(" "),a("li",[t._v("吞吐率数值表示当前机器的整体性能，值越大越好。")])])]),t._v(" "),a("li",[a("code",[t._v("请求等待时间：RT（Response Time），响应时间")]),t._v("。等价于 Latency。有平均延时和 Pct 延时，因为平均值不能反映服务真实响应延时，实际压测中一般参考 Pct99，Pct90 分位等指标。")]),t._v(" "),a("li",[t._v("并发连接数：某个时刻服务器所接受的请求数目。")]),t._v(" "),a("li",[t._v("并发用户数：某个时刻服务器所接受的请求用户数目。")])]),t._v(" "),a("p",[t._v("其中吞吐率 QPS，使我们最关心的指标。")]),t._v(" "),a("h2",{attrs:{id:"apache-ab"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#apache-ab"}},[t._v("#")]),t._v(" apache ab")]),t._v(" "),a("h3",{attrs:{id:"ab-简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ab-简介"}},[t._v("#")]),t._v(" ab 简介")]),t._v(" "),a("blockquote",[a("p",[t._v("ab - Apache HTTP server benchmarking tool")]),t._v(" "),a("blockquote",[a("p",[t._v("ab is a tool for benchmarking your Apache Hypertext Transfer Protocol (HTTP) server. It is designed to give you an impression of how your current Apache installation performs. This especially shows you how many requests per second your Apache installation is capable of serving.")])])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://httpd.apache.org/docs/2.4/programs/ab.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("ab"),a("OutboundLink")],1),t._v(" 是 apachebench 命令的缩写。ab 的原理：ab 的测试方式是基于 URL 的，ab 命令会创建多个并发访问线程，模拟多个访问者同时对某一 URL 地址进行访问。ab 命令对发出负载的计算机要求很低，它既不会占用很高 CPU，也不会占用很多内存。但却会给目标服务器造成巨大的负载，其原理类似 CC 攻击。自己测试使用也需要注意，否则一次上太多的负载。可能造成目标服务器资源耗完，严重时甚至导致死机。")]),t._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[t._v("WARNING")]),t._v(" "),a("p",[t._v("个人做测试的时候尤其需要注意：压测的目标是为了找出压测服务器的负载上限、性能瓶颈（"),a("strong",[t._v("以资源消耗 70%为基准")]),t._v("）；")]),t._v(" "),a("p",[t._v("而不是盲目发起过多请求，消耗目标表服务器资源甚至宕机。这属于故意破坏他人计算机系统，严重情况下目标服务器公司会根据请求日志进行追责。")])]),t._v(" "),a("h3",{attrs:{id:"安装和使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装和使用"}},[t._v("#")]),t._v(" 安装和使用")]),t._v(" "),a("p",[t._v("命令 ab 为 apache 服务器自带工具。如果不想安装 apache 又要使用命令 ab，可以支架安装 apache 工具包 httpd-tools：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" httpd-tools\n")])])]),a("p",[t._v("Mac 系统已经自带 ab，无需安装。")]),t._v(" "),a("p",[t._v("ab 的命令参数比较多，这里只介绍常用的参数和用法：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("-n：requests，在测试会话中所执行的请求个数。默认时，仅执行一个请求。\n-c：concurrency，一次产生的请求数，可以理解为并发数，默认是一次一个。\n-t：timelimit，测试所进行的最大秒数, 可以当做请求的超时时间。默认时，没有时间限制。\n-p：postfile，包含了需要POST的数据的文件。\n-T：content-type，POST数据所使用的Content-type头信息。\n")])])]),a("ul",[a("li",[t._v("get 请求："),a("code",[t._v('ab -n 1000 -c 10 -t 10 "testurl.com/get_user?ui…"')]),t._v("。这行表示"),a("strong",[t._v("处理 1000 个请求并每次同时运行 10 次请求，超时时间为 10 秒")]),t._v("。")]),t._v(" "),a("li",[t._v("post 请求："),a("code",[t._v('ab -n 1000 -c 10 -t 10 -p post.json -T "application/x-www-form-urlencoded" "testurl.com/add_user"')]),t._v("，其中 post.json 是接口需要的 json 参数。")])]),t._v(" "),a("h3",{attrs:{id:"目标完成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目标完成"}},[t._v("#")]),t._v(" 目标完成")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 方式A")]),t._v("\nab -c "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" -n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" https://api.testurl.net/internal/v1/order/detail"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("?_s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1622983825122")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("order_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6970511624989860652")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("user_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2621662569459976")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 方式B")]),t._v("\nab -c "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" -n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" https://bff.testurl.net/internal/v1/order/detail"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("?_s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1622985193790")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("order_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6970598141146211116")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("user_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2621662569459976")]),t._v("\n")])])]),a("ul",[a("li",[t._v("方式 A 测试结果：")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("This is ApacheBench, Version "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.3")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$Revision")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1843412")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nCopyright "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1996")]),t._v(" Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking api.testurl.net "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("be patient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".done\n\n\nServer Software:        nginx\nServer Hostname:        api.testurl.net\nServer Port:            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\nSSL/TLS Protocol:       TLSv1.2,ECDHE-RSA-AES256-GCM-SHA384,2048,256\nServer Temp Key:        ECDH P-256 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),t._v(" bits\nTLS Server Name:        api.testurl.net\n\nDocument Path:          /internal/v1/order/detail?_s"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1622983825122")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("order_id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6970511624989860652")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("user_id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2621662569459976")]),t._v("\nDocument Length:        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1116")]),t._v(" bytes\n\nConcurrency Level:      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\nTime taken "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" tests:   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.799")]),t._v(" seconds\nComplete requests:      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\nFailed requests:        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nTotal transferred:      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("186696")]),t._v(" bytes\nHTML transferred:       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("111600")]),t._v(" bytes\nRequests per second:    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("55.59")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#/sec] (mean)")]),t._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1798.991")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("17.990")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mean, across all concurrent requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nTransfer rate:          "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("101.35")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Kbytes/sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" received\n\nConnection Times "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n              min  mean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+/-sd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" median   max\nConnect:       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("66")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1047")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99.0")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1056")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1061")]),t._v("\nProcessing:   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("138")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("297")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("47.0")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("539")]),t._v("\nWaiting:      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("132")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("297")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("47.2")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("539")]),t._v("\nTotal:        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("204")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1344")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123.3")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1356")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1595")]),t._v("\n\nPercentage of the requests served within a certain "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1356")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("66")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1368")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1382")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1387")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1406")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("95")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1409")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("98")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1411")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1595")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1595")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("longest request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ul",[a("li",[t._v("方式 B 测试结果：")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("This is ApacheBench, Version "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2.3")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$Revision")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1843412")]),t._v(" $"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\nCopyright "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1996")]),t._v(" Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking bff.testurl.net "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("be patient"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("..")]),t._v(".done\n\n\nServer Software:        nginx\nServer Hostname:        bff.testurl.net\nServer Port:            "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("443")]),t._v("\nSSL/TLS Protocol:       TLSv1.2,ECDHE-RSA-AES256-GCM-SHA384,2048,256\nServer Temp Key:        ECDH P-256 "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),t._v(" bits\nTLS Server Name:        bff.testurl.net\n\nDocument Path:          /internal/v1/order/detail?_s"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1622985193790")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("order_id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6970598141146211116")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("user_id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2621662569459976")]),t._v("\nDocument Length:        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1234")]),t._v(" bytes\n\nConcurrency Level:      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\nTime taken "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" tests:   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.827")]),t._v(" seconds\nComplete requests:      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("\nFailed requests:        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nTotal transferred:      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("186898")]),t._v(" bytes\nHTML transferred:       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("123400")]),t._v(" bytes\nRequests per second:    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("54.74")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#/sec] (mean)")]),t._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1826.885")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nTime per request:       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("18.269")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mean, across all concurrent requests"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nTransfer rate:          "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99.91")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("Kbytes/sec"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" received\n\nConnection Times "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n              min  mean"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("+/-sd"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" median   max\nConnect:       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("953")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("250.0")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1026")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1031")]),t._v("\nProcessing:   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("107")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("370")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("198.5")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("343")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("916")]),t._v("\nWaiting:      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("107")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("370")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("197.7")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("343")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("911")]),t._v("\nTotal:        "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("238")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1323")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("187.8")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1328")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1591")]),t._v("\n\nPercentage of the requests served within a certain "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1328")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("66")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1391")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1418")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1529")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1551")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("95")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1576")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("98")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1586")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1591")]),t._v("\n "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("%   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1591")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("longest request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("结果比较：")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",{staticStyle:{"text-align":"left"}},[t._v("指标")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("含义")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("方式 A（api.testurl.net）")]),t._v(" "),a("th",{staticStyle:{"text-align":"left"}},[t._v("方式 B（bff.testurl.net）")])])]),t._v(" "),a("tbody",[a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Concurrency Level")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("并发用户数")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("100")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("100")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Complete requests")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("总请求数量")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("100")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("100")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Failed requests")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("失败请求数")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("0")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("0")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Requests per second")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("吞吐率，也叫 QPS")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("55.59 "),a("a",{attrs:{href:"mean"}},[t._v("#/sec")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("54.74 "),a("a",{attrs:{href:"mean"}},[t._v("#/sec")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Time taken for tests")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("所有这些请求被处理完成所花费的总时间")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1.799 seconds")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1.827 seconds")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Time per request")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("用户平均请求等待时间，即用户完成一个请求所需要的时间")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1798.991 "),a("a",{attrs:{href:"mean"}},[t._v("ms")])]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("1826.885 "),a("a",{attrs:{href:"mean"}},[t._v("ms")])])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Time per requet(across all concurrent request)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("服务器完成一个请求的时间，是吞吐率的倒数")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("17.990 [ms]")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("18.269 [ms]")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Transfer rate")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("网络传输速度")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("101.35 [Kbytes/sec] received")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("99.91 [Kbytes/sec] received")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Percentage of requests served within a certain time（ms）")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("描述每个请求处理时间的分布情况，例如第一行表示有 50%的请求都是在 XXXms 内完成的")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("略")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("略")])]),t._v(" "),a("tr",[a("td",{staticStyle:{"text-align":"left"}},[t._v("Connection Times (ms)")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("这几行组成的表格主要是针对响应时间也就是第一个 Time per request 进行细分和统计。一个请求的响应时间可以分成网络链接（Connect），系统处理（Processing）和等待（Waiting）三个部分。表中 min 表示最小值；mean 表示平均值；[+/-sd]表示标准差（Standard Deviation），也称均方差（mean square error），表示数据的离散程度，数值越大表示数据越分散，系统响应时间越不稳定。median 表示中位数；max 表示最大值。需要注意的是表中的 Total 并不等于前三行数据相加，因为前三行的数据并不是在同一个请求中采集到的，可能某个请求的网络延迟最短，但是系统处理时间又是最长的呢。所以 Total 是从整个请求所需要的时间的角度来统计的。")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("略")]),t._v(" "),a("td",{staticStyle:{"text-align":"left"}},[t._v("略")])])])]),t._v(" "),a("h3",{attrs:{id:"ab-的优缺点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ab-的优缺点"}},[t._v("#")]),t._v(" ab 的优缺点")]),t._v(" "),a("ul",[a("li",[t._v("优点：\n"),a("ol",[a("li",[t._v("简单易用")]),t._v(" "),a("li",[t._v("支持 post 请求，接受 json 文件作为参数 （方便编写脚本批量测试）")]),t._v(" "),a("li",[t._v("压测量不大的情况下够用(1024 个并发以下)")])])]),t._v(" "),a("li",[t._v("缺点：\n"),a("ol",[a("li",[t._v("无法持续时间压测，无法控制速度压测")]),t._v(" "),a("li",[t._v("压测量起不来。主要是 ab 只能利用单个 cpu，只能是单进程，而系统限制每个进程打开的最大文件数为 1024，所以最多 1024 个线程，如果是多核 cpu，就浪费了这些资源。")])])])]),t._v(" "),a("h2",{attrs:{id:"wrk"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wrk"}},[t._v("#")]),t._v(" wrk")]),t._v(" "),a("blockquote",[a("p",[t._v("wrk is a modern HTTP benchmarking tool capable of generating significant load when run on a single multi-core CPU. It combines a multithreaded design with scalable event notification systems such as epoll and kqueue.")])]),t._v(" "),a("p",[a("a",{attrs:{href:"github.com/wg/wrk"}},[t._v("wrk")]),t._v(" 相比于 ab，可以在单机多核 CPU 环境下，能够使用系统自带高性能 I/O 机制：epoll(linux)，kqueue(mac)，通过多线程和事件模式更少的线程就制造出更大的并发。")]),t._v(" "),a("h3",{attrs:{id:"安装和使用-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装和使用-2"}},[t._v("#")]),t._v(" 安装和使用")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mac安装")]),t._v("\nbrew "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" wrk\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 使用")]),t._v("\nUsage: wrk "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("options"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("url"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n  Options:\n    -c, --connections "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("N"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  保持的连接数（会话数）\n    -d, --duration    "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("T"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  压测持续时间"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    -t, --threads     "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("N"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  开多少线程压测，用于控制并发请求速度。最大值一般是cpu总核心数的2-4倍\n\n    -s, --script      "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("S"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  指定Lua脚本路径（post请求写一些参数到脚本里）\n    -H, --header      "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("H"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  为每一个HTTP请求添加HTTP头\n        --latency          在压测结束后，打印延迟统计信息\n        --timeout     "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("T"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("  超时时间\n    -v, --version          打印正在使用的wrk的详细版本信息\n\n  Numeric arguments may include a SI unit "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("1k, 1M, 1G"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  Time arguments may include a "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("time")]),t._v(" unit "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("2s, 2m, 2h"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("ul",[a("li",[a("code",[t._v("wrk -t12 -c400 -d30s -T30s --latency www.baidu.com")]),t._v("；")]),t._v(" "),a("li",[t._v("上面这条命令的意思是用 12 个线程来模拟 400 个并发连接，整个测试持续 30 秒，连接超时 30 秒，打印出请求的延迟统计信息。")]),t._v(" "),a("li",[a("strong",[t._v("注意")]),t._v("：关于线程数，并不是设置的越大，压测效果越好，线程设置过大，反而会导致线程切换过于频繁，效果降低，一般来说，推荐设置成压测机器 CPU 核心数的 2 倍到 4 倍就行了。")]),t._v(" "),a("li",[t._v("关于长连接和短连接：apache bench 默认短连接，wrk"),a("code",[t._v("默认长连接")]),t._v("。wrk 如需测试短连接，可添加 -H “Connection:Close” 来关闭长连接。")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("Running 30s "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" @ http://www.baidu.com （压测时间30s）\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" threads and "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("400")]),t._v(" connections （共12个测试线程，400个连接）\n\t\t\t  （平均值） （标准差）  （最大值）（正负一个标准差所占比例）\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    （延迟）\n    Latency   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("386")]),t._v(".32ms  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("380")]),t._v(".75ms   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(".00s    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("86.66")]),t._v("%\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("每秒请求数"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    Req/Sec    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("17.06")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("13.91")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("252.00")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("87.89")]),t._v("%\n  Latency Distribution （延迟分布）\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("%  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("218")]),t._v(".31ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v("%  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("520")]),t._v(".60ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),t._v("%  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("955")]),t._v(".08ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v("%    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(".93s（99分位的延迟：%99的请求在1.93s以内）\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4922")]),t._v(" requests "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(".06s, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("73")]),t._v(".86MB "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("read")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),t._v(".06s内处理了4922个请求，耗费流量73.86MB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  Socket errors: connect "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("read")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("write")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("311")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("发生错误数"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nRequests/sec:    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("163.76")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("QPS "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("163.76")]),t._v(",即平均每秒处理请求数为163.76"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nTransfer/sec:      "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(".46MB "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("平均每秒流量2.46MB"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h3",{attrs:{id:"目标完成-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目标完成-2"}},[t._v("#")]),t._v(" 目标完成")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 方式A")]),t._v("\nwrk -t12 -c100 -d10s --timeout 10s --latency https://api.testurl.net/internal/v1/order/detail"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("?_s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1622983825122")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("order_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6970511624989860652")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("user_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2621662569459976")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 方式B")]),t._v("\nwrk -t12 -c100 -d10s --timeout 10s --latency https://bff.testurl.net/internal/v1/order/detail"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("?_s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1622985193790")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("order_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6970598141146211116")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("user_id"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2621662569459976")]),t._v("\n")])])]),a("ul",[a("li",[t._v("方式 A：")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("Running 10s "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" @ https://api.testurl.net/internal/v1/order/detail?_s"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1622983825122")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("order_id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6970511624989860652")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("user_id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2621662569459976")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" threads and "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("214")]),t._v(".70ms   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("59")]),t._v(".26ms   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(".24s    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("75.25")]),t._v("%\n    Req/Sec    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("30.81")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("14.86")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80.00")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("68.26")]),t._v("%\n  Latency Distribution\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("%  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("216")]),t._v(".80ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v("%  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("244")]),t._v(".90ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),t._v("%  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("275")]),t._v(".73ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v("%  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("350")]),t._v(".28ms\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3652")]),t._v(" requests "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(".09s, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(".50MB "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("read")]),t._v("\nRequests/sec:    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("361.87")]),t._v("\nTransfer/sec:    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("659")]),t._v(".60KB\n")])])]),a("ul",[a("li",[t._v("方式 B：")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("Running 10s "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("test")]),t._v(" @ https://bff.testurl.net/internal/v1/order/detail?_s"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1622985193790")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("order_id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("6970598141146211116")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("user_id")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2621662569459976")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("12")]),t._v(" threads and "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v(" connections\n  Thread Stats   Avg      Stdev     Max   +/- Stdev\n    Latency   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("287")]),t._v(".70ms  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("111")]),t._v(".24ms   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(".22s    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("67.98")]),t._v("%\n    Req/Sec    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("24.61")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("14.93")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80.00")]),t._v("     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("60.31")]),t._v("%\n  Latency Distribution\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("%  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("280")]),t._v(".15ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("75")]),t._v("%  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("358")]),t._v(".75ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),t._v("%  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("430")]),t._v(".48ms\n     "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v("%  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("583")]),t._v(".87ms\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2704")]),t._v(" requests "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("in")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v(".10s, "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(".82MB "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("read")]),t._v("\nRequests/sec:    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("267.74")]),t._v("\nTransfer/sec:    "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("488")]),t._v(".63KB\n")])])]),a("h3",{attrs:{id:"wrk2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#wrk2"}},[t._v("#")]),t._v(" wrk2")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/giltene/wrk2",target:"_blank",rel:"noopener noreferrer"}},[t._v("wrk2"),a("OutboundLink")],1),t._v(" 是 wrk 的进化版，其号称能够提供稳定的吞吐量以及更精确的延时统计，反映到配置参数上就是 wrk2 增加了 --rate 参数用于设置吞吐量和--u_latency 参数用于显示不正确（统计学角度）的延时统计。")]),t._v(" "),a("h2",{attrs:{id:"autocannon"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#autocannon"}},[t._v("#")]),t._v(" autocannon")]),t._v(" "),a("blockquote",[a("p",[t._v("A HTTP/1.1 benchmarking tool written in node, greatly inspired by wrk and wrk2, with support for HTTP pipelining and HTTPS. On my box, autocannon can produce more load than wrk and wrk2, see limitations for more details.")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/mcollina/autocannon",target:"_blank",rel:"noopener noreferrer"}},[t._v("autocannon"),a("OutboundLink")],1),t._v("，fast HTTP/1.1 benchmarking tool written in Node.js，使用 node 编写的压测工具，能比 wrk 生成更多负载。")]),t._v(" "),a("h3",{attrs:{id:"安装和使用-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装和使用-3"}},[t._v("#")]),t._v(" 安装和使用")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i autocannon -g\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("npm")]),t._v(" i autocannon --save "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# or if you want to use the API or as a dependency:")]),t._v("\n")])])]),a("p",[t._v("常用参数：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("-c/--connections NUM 并发连接的数量，默认10\n-p/--pipelining NUM 每个连接的流水线请求请求数。默认1\n-d/--duration SEC 执行的时间，单位秒\n-m/--method METHOD 请求类型 默认GET\n-b/--body BODY 请求报文体\n")])])]),a("p",[t._v("使用方式：")]),t._v(" "),a("ol",[a("li",[t._v("命令行使用与 wrk 类似："),a("code",[t._v("autocannon -c 100 -d 5 -p 2 http://127.0.0.1:3000/test")]),t._v("；")]),t._v(" "),a("li",[t._v("api 调用 autocannon(opts[, cb]) 便于编写脚本。")])]),t._v(" "),a("h3",{attrs:{id:"目标完成-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#目标完成-3"}},[t._v("#")]),t._v(" 目标完成")]),t._v(" "),a("p",[t._v("略")]),t._v(" "),a("h2",{attrs:{id:"参考链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考链接"}},[t._v("#")]),t._v(" 参考链接")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://juejin.cn/post/6844903962244579341",target:"_blank",rel:"noopener noreferrer"}},[t._v("ab 和 wrk 接口压测实践"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://httpd.apache.org/docs/2.4/programs/ab.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("apache.org"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/linjiqin/p/9058432.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("网站性能压力测试工具--apache ab 使用详解"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/l199616j/p/12156600.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("wrk 性能测试（详解）"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://juejin.cn/post/6844903665166188551",target:"_blank",rel:"noopener noreferrer"}},[t._v("对 node 工程进行压力测试与性能分析"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);s.default=n.exports}}]);